generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SessionStatus {
  scheduled
  completed
  cancelled
}

enum EmailStatus {
  success
  failed
}

model User {
  id           String    @id @default(cuid())
  code         String    @unique
  name         String
  email        String    @unique
  passwordHash String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  sessions     Session[]
}

model Customer {
  id           String    @id @default(cuid())
  name         String
  email        String    @unique
  passwordHash String
  phone        String?
  note         String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  sessions     Session[]
}

model Session {
  id         String        @id @default(cuid())
  customerId String
  staffId    String
  startAt    DateTime
  endAt      DateTime
  status     SessionStatus @default(scheduled)
  meetUrl    String
  externalId String?
  title      String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  customer   Customer      @relation(fields: [customerId], references: [id])
  staff      User          @relation(fields: [staffId], references: [id])
  emailLogs  EmailLog[]

  @@unique([staffId, startAt])
  @@index([staffId, startAt])
}

model EmailLog {
  id           String      @id @default(cuid())
  sessionId    String
  toEmail      String
  subject      String
  body         String
  status       EmailStatus
  errorMessage String?
  sentAt       DateTime    @default(now())
  session      Session     @relation(fields: [sessionId], references: [id])

  @@index([sessionId])
}
